---
title: "Plot Examples"
author: "Marius Barth"
date: "18 8 2021"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(papaja)
knitr::opts_knit$set(global.par = TRUE)

set.seed(43L)
palette("R4")

example_data <- expand.grid(
  A = 1:5,
  B = 1:3,
  C = 1:2,
  D = 1:4,
  sid = 1:12
)
example_data$first_dv <- rnorm(12)[example_data$sid] + 
  rnorm(5)[example_data$A] + 
  rnorm(3)[example_data$B] +
  rnorm(2)[example_data$C] + 
  rnorm(4)[example_data$D] +
  rnorm(nrow(example_data))

variable_labels(example_data) <- list(
  A = expression("Factor"~bold(A))
  , B = expression("Factor"~bold(B))
  , C = expression("Factor"~bold(C))
  , D = expression("Factor"~bold(D))#
  , first_dv = expression("Dependent variable"~italic(Y)[1])
)
```


```{r}
apa_beeplot(data = example_data, dv = "first_dv", id = "sid", factors = c("A", "B"), dispersion = wsci, level = .99)
```


# Swarms and legends should properly inherit arguemnts

- Points' background and line colour
- Line width of points
- Point size, both visual size and for calculating swarm coordinates

```{r}
apa_beeplot(data = example_data, dv = "first_dv", id = "sid", factors = c("A", "B")) |>
  points(
    cex = seq(1, 2, length = 3)
    , bg = 2:4
    , pch = 23:25
    , col = "skyblue4"
    , lwd = 3
  )
```



## More complex designs

```{r}
apa_beeplot(data = example_data, dv = "first_dv", id = "sid", factors = c("A", "B", "C"))
```


## Bar plots

```{r}
apa_barplot(data = example_data, dv = "first_dv", id = "sid", factors = c("A", "B"))
apa_barplot(data = example_data, dv = "first_dv", id = "sid", factors = c("B", "A"))
apa_barplot(data = example_data, dv = "first_dv", id = "sid", factors = "A")
apa_beeplot(data = data.frame(sid = seq_len(1e3), dv = rnorm(1e3)), dv = "dv", id = "sid", level = (1-1e-6) )
# todo: fix x coordinates of error bars
```


## Line plots

```{r}
apa_lineplot(data = example_data, dv = "first_dv", id = "sid", factors = c("A", "B", "C"))
```


## Change legend of a beeplot

```{r fig.width = 10, fig.height = 20}
apa_beeplot(data = example_data, dv = "first_dv", id = "sid", factors = c("A", "B", "C", "D")) |>
  legends(x = "topleft")
```



## Direct usage of new backend

```{r}
apa_plot(data = example_data, dv = "first_dv", id = "sid", factors = c("A", "B")) |>
  swarms() |>
  error_bars() |>
  points() |>
  x_axis() |>
  y_axis() |>
  annotation()
```

## Formula interface

```{r}
apa_plot(formula = first_dv ~ A * B + (1 | sid), data = example_data) |>
  error_bars() |>
  lines() |>
  points() |>
  x_axis() |>
  y_axis() |>
  annotation()
```

```{r}
apa_beeplot(formula = first_dv ~ (A * B | sid), data = example_data) |>
  error_bars(lwd = 1.5, col = 1:3) |>
  points(lwd = 1.4, col = 1:3, bg = 1:3) |>
  x_axis(lwd = 1.3, col = "skyblue4", col.axis = ) |>
  y_axis(lwd = 1.3, col = "skyblue4") |>
  annotation(main = "blabla", col.lab = "skyblue4")

```


```{r}
apa_barplot(first_dv ~ (A + B | sid), example_data) |>
  intercept(y = 1:5/5, lwd = 3, col = 4) |>
  add() |>
  intercept(y = 1:5/5 + 1, lwd = 2, col = 2)

```


